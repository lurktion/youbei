(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4ab42abc"],{"0fb6":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",[a("el-main",[a("el-row",[a("el-col",{attrs:{span:22,offset:1}},[a("el-card",[a("div",{staticClass:"indexbtngroup"},[a("div",{staticClass:"indexbtn"},[a("AddTask",{ref:"AddTask",attrs:{flush:e.taskGet}})],1)])])],1)],1),a("el-row",[a("el-col",{attrs:{span:22,offset:1}},[a("el-card",[a("div",{staticClass:"indexsearch"},[a("el-form",{attrs:{model:e.query,size:"mini",inline:!0}},[a("el-form-item",{attrs:{label:""}},[a("el-input",{attrs:{placeholder:"任务编号",size:"mini",clearable:""},model:{value:e.query.name,callback:function(t){e.$set(e.query,"name",t)},expression:"query.name"}})],1),a("el-form-item",{attrs:{label:""}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.search}},[e._v("搜索")])],1)],1)],1)])],1)],1),a("el-row",{staticClass:"block"},[a("el-col",{attrs:{span:22,offset:1}},[a("el-table",{attrs:{data:e.tasks,border:"",size:"mini"}},[a("el-table-column",{attrs:{label:"编号",prop:"name",width:"150"}}),a("el-table-column",{attrs:{prop:"dbtype",label:"数据库类型",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:"primary",size:"mini"}},[e._v(e._s(t.row.dbtype))])]}}])}),a("el-table-column",{attrs:{prop:"dbpath",label:"路径"}}),a("el-table-column",{attrs:{prop:"crontab",label:"计划任务",width:"140"}}),a("el-table-column",{attrs:{prop:"savepath",label:"保存地址"}}),a("el-table-column",{attrs:{prop:"created",label:"创建时间",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.$public.comTime(t.row.created)))])]}}])}),a("el-table-column",{attrs:{prop:"status",label:"操作",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{type:"warning",underline:!1},on:{click:function(a){return e.runJob(t.row.id)}}},[e._v("手动执行")]),a("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(a){return e.edit(t.row.id)}}},[e._v("修改")]),a("el-link",{attrs:{type:"danger",underline:!1},on:{click:function(a){return e.deleteTask(t.row.id)}}},[e._v("删除")])]}}])})],1),a("div",{staticClass:"block"},[a("el-pagination",{attrs:{small:!0,background:"","page-size":e.query.pageSize,"current-page":e.query.currentPage,layout:"total,prev, pager, next",total:e.total},on:{"current-change":e.current_change}})],1)],1)],1),a("EditTask",{ref:"EditTask",attrs:{flush:e.taskGet}})],1)],1)},i=[],l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{attrs:{size:"mini"},on:{click:e.open}},[e._v("添加任务")]),a("el-dialog",{attrs:{title:"新建任务",visible:e.NewTaskDialog,modal:!1},on:{"update:visible":function(t){e.NewTaskDialog=t}}},[a("el-row",[a("el-col",{attrs:{span:22,offset:1}},[a("el-steps",{attrs:{active:e.step,"finish-status":"success",simple:""}},[a("el-step",{attrs:{title:"1.选择要备份的目录"}}),a("el-step",{attrs:{title:"2.选择本地保存目录"}}),a("el-step",{attrs:{title:"3.任务配置"}}),a("el-step",{attrs:{title:"3.确认"}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:13,offset:1}},[a("el-form",{attrs:{model:e.taskform,size:"mini","label-width":"180px"}},[0===e.step?a("el-form-item",{attrs:{label:"路径",prop:"dbpath",rules:[{required:!0,message:"请选择路径",trigger:"blur"}]}},[a("el-tree",{key:"dbpath",ref:"dbpath",attrs:{props:e.srcprops,load:e.srcloadNode,"check-on-click-node":!0,lazy:"","node-key":"path","show-checkbox":"","check-strictly":!0},on:{check:e.srcnodeClick}})],1):e._e(),1===e.step?a("el-form-item",{attrs:{label:"保存路径",prop:"savepath",rules:[{required:!0,message:"请输入保存路径",trigger:"blur"}]}},[a("el-tree",{key:"savepath",ref:"savepath",attrs:{props:e.props,load:e.loadNode,"check-on-click-node":!0,lazy:"","node-key":"path","show-checkbox":"","check-strictly":!0},on:{check:e.nodeClick}})],1):e._e(),1===e.step?a("el-form-item",{attrs:{label:"是否加密"}},[a("el-col",{attrs:{span:4}},[a("el-switch",{model:{value:e.enablezippwd,callback:function(t){e.enablezippwd=t},expression:"enablezippwd"}})],1),e.enablezippwd?a("el-col",{attrs:{span:3,offset:1}},[e._v("密码:")]):e._e(),e.enablezippwd?a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{"show-password":""},model:{value:e.taskform.zippwd,callback:function(t){e.$set(e.taskform,"zippwd",t)},expression:"taskform.zippwd"}})],1):e._e()],1):e._e(),2===e.step?a("el-form-item",{attrs:{label:"异地存储"}},[a("el-select",{attrs:{multiple:""},model:{value:e.taskform.rs,callback:function(t){e.$set(e.taskform,"rs",t)},expression:"taskform.rs"}},e._l(e.remotestorages,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),2===e.step?a("el-form-item",{attrs:{label:"执行频率"}},[a("el-select",{on:{change:e.changepinlv},model:{value:e.pinlv,callback:function(t){e.pinlv=t},expression:"pinlv"}},e._l(e.$public.pinlvs,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"month"==e.pinlv&&2===e.step?a("el-form-item",{attrs:{label:"日期"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.cjobs},model:{value:e.day,callback:function(t){e.day=t},expression:"day"}},e._l(e.$public.days,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"week"==e.pinlv&&2===e.step?a("el-form-item",{attrs:{label:"周"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.cjobs},model:{value:e.week,callback:function(t){e.week=t},expression:"week"}},e._l(e.$public.weeks,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),2===e.step?a("el-form-item",{attrs:{label:"时间点"}},[a("el-time-picker",{attrs:{placeholder:"任意时间点","value-format":"H m s"},on:{change:e.createjobs},model:{value:e.times,callback:function(t){e.times=t},expression:"times"}})],1):e._e(),2===e.step?a("el-form-item",{attrs:{label:"计划任务",prop:"crontab",rules:[{required:!0,message:"请输入 计划任务",trigger:"blur"}]}},[a("el-input",{model:{value:e.taskform.crontab,callback:function(t){e.$set(e.taskform,"crontab",t)},expression:"taskform.crontab"}})],1):e._e(),2===e.step?a("el-form-item",{attrs:{label:"本地备份保留数"}},[a("el-input-number",{attrs:{min:1,max:100},model:{value:e.taskform.expire,callback:function(t){e.$set(e.taskform,"expire",t)},expression:"taskform.expire"}}),e._v("个 ")],1):e._e(),3!==e.step?a("el-form-item",[e.step>0?a("el-button",{attrs:{size:"mini"},on:{click:e.stepCut}},[e._v("上一步")]):e._e(),e.step<4?a("el-button",{attrs:{size:"mini"},on:{click:e.stepPlus}},[e._v("下一步")]):e._e()],1):e._e()],1)],1)],1),3===e.step?a("el-row",[a("el-col",{attrs:{span:22,offset:1}},[a("el-descriptions",{staticStyle:{"margin-top":"15px"},attrs:{title:"要备份的目录或文件",border:"",size:"mini",direction:"vertical"}},[a("el-descriptions-item",{attrs:{label:"目录"}},[e._v(e._s(e.taskform.dbpath))])],1),a("el-descriptions",{staticStyle:{"margin-top":"15px"},attrs:{title:"本地保存目录",border:"",size:"mini",direction:"vertical"}},[a("el-descriptions-item",{attrs:{label:"本地保存目录"}},[e._v(e._s(e.taskform.savepath))]),e.enablezippwd?a("el-descriptions-item",{attrs:{label:"压缩密码"}},[e._v(e._s(e.taskform.zippwd))]):e._e()],1),a("el-descriptions",{staticStyle:{"margin-top":"15px"},attrs:{title:"任务配置",border:"",size:"mini",direction:"vertical"}},[e.taskform.rs.length>0?a("el-descriptions-item",{attrs:{label:"异地存储"}},[a("el-select",{attrs:{multiple:"",disabled:"",size:"mini"},model:{value:e.taskform.rs,callback:function(t){e.$set(e.taskform,"rs",t)},expression:"taskform.rs"}},e._l(e.remotestorages,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),a("el-descriptions-item",{attrs:{label:"执行频率"}},[e._v(e._s(e.$public.pinlvFmt(e.pinlv)))]),"month"===e.pinlv?a("el-descriptions-item",{attrs:{label:"日期"}},[e._v(e._s(e.day))]):e._e(),"week"===e.pinlv?a("el-descriptions-item",{attrs:{label:"周"}},[e._v(e._s(e.week))]):e._e(),a("el-descriptions-item",{attrs:{label:"时间点"}},[e._v(e._s(e.$public.timesFmt(e.times)))]),a("el-descriptions-item",{attrs:{label:"计划任务"}},[e._v(e._s(e.taskform.crontab))]),a("el-descriptions-item",{attrs:{label:"本地备份保留数"}},[e._v(e._s(e.taskform.expire))])],1)],1),a("el-col",{staticStyle:{"margin-top":"15px"},attrs:{span:22,offset:1}},[3===e.step?a("el-button",{attrs:{size:"mini"},on:{click:e.stepCut}},[e._v("上一步")]):e._e(),a("el-button",{attrs:{type:"success",size:"mini"},on:{click:e.addtask}},[e._v("确定")])],1)],1):e._e()],1)],1)},r=[],n={props:{flush:{type:Function,default:function(){}}},data:function(){return{NewTaskDialog:!1,step:0,keyName:"",taskform:{dbtype:"file",crontab:"",rs:[],pausenum:0,expire:1},day:"1",week:"1",times:"",pinlv:"day",enablezippwd:!1,remotestorages:[],props:{label:"label",children:"children",isLeaf:"isLeaf",path:"path"},srcprops:{label:"label",children:"children",isLeaf:"isLeaf",path:"path"}}},methods:{open:function(){this.NewTaskDialog=!0,this.ftpGet()},nodeClick:function(e){this.$refs.savepath.setCheckedNodes([e]),this.taskform.savepath=e.path},srcnodeClick:function(e){this.$refs.dbpath.setCheckedNodes([e]),this.taskform.dbpath=e.path},loadNode:function(e,t){0===e.level?this.$http.Get(this.$api.dirlist,{},(function(e){return t(e)})):this.$http.Get(this.$api.dirlist,{dir:e.data.path},(function(e){return t(e)}))},srcloadNode:function(e,t){0===e.level?this.$http.Get(this.$api.dirlist,{},(function(e){return t(e)})):this.$http.Get(this.$api.dirlist,{dir:e.data.path,isdir:!1},(function(e){return t(e)}))},stepCut:function(){this.step=this.step-1},stepPlus:function(){this.step=this.step+1},ftpGet:function(){var e=this;this.$http.Get(this.$api.ftps,{page:1,count:-1},(function(t){e.remotestorages=t.data}))},changepinlv:function(e){this.pinlv=e,this.cjobs()},createjobs:function(e){this.times=e,this.cjobs()},addtask:function(){var e=this;this.$http.Post(this.$api.task,this.taskform,(function(){e.flush(),e.NewTaskDialog=!1}),"添加任务")},cjobs:function(){var e=this.times.split(" "),t="";3===e.length&&(t=e[2]+" "+e[1]+" "+e[0],"month"===this.pinlv&&this.day?t=t+" "+this.day+" * *":"week"===this.pinlv&&this.week?t=t+" * * "+this.week:t+=" * * *"),this.taskform.crontab=t}}},o=n,c=a("2877"),p=Object(c["a"])(o,l,r,!1,null,null,null),u=p.exports,d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-drawer",{attrs:{title:"编辑任务",visible:e.drawer,direction:"rtl",size:550,modal:!1},on:{"update:visible":function(t){e.drawer=t}}},[a("el-row",[a("el-col",{attrs:{span:22,offset:1}},[a("el-form",{attrs:{model:e.taskform,size:"mini","label-width":"120px"}},[a("el-divider",[e._v("文件目录配置")]),"file"==e.taskform.dbtype?a("el-form-item",{attrs:{label:"路径",prop:"dbpath",rules:[{required:!0,message:"请选择路径",trigger:"blur"}]}},[a("el-input",{attrs:{autocomplete:"off",disabled:!0},model:{value:e.taskform.dbpath,callback:function(t){e.$set(e.taskform,"dbpath",t)},expression:"taskform.dbpath"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){return e.enableDirSearch("dbpath")}},slot:"append"})],1)],1):e._e(),a("el-divider",[e._v("任务配置")]),a("el-form-item",{attrs:{label:"保存路径",prop:"savepath",rules:[{required:!0,message:"请输入保存路径",trigger:"blur"}]}},[a("el-input",{attrs:{disabled:!0},model:{value:e.taskform.savepath,callback:function(t){e.$set(e.taskform,"savepath",t)},expression:"taskform.savepath"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){return e.enableDirSearch("savepath")}},slot:"append"})],1)],1),a("el-form-item",{attrs:{label:"是否加密"}},[a("el-col",{attrs:{span:4}},[a("el-switch",{model:{value:e.enablezippwd,callback:function(t){e.enablezippwd=t},expression:"enablezippwd"}})],1),e.enablezippwd?a("el-col",{attrs:{span:3,offset:1}},[e._v("密码:")]):e._e(),e.enablezippwd?a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{"show-password":""},model:{value:e.taskform.zippwd,callback:function(t){e.$set(e.taskform,"zippwd",t)},expression:"taskform.zippwd"}})],1):e._e()],1),a("el-form-item",{attrs:{label:"异地存储"}},[a("el-select",{attrs:{multiple:""},model:{value:e.taskform.rs,callback:function(t){e.$set(e.taskform,"rs",t)},expression:"taskform.rs"}},e._l(e.remotestorages,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"执行频率"}},[a("el-select",{on:{change:e.changepinlv},model:{value:e.pinlv,callback:function(t){e.pinlv=t},expression:"pinlv"}},e._l(e.$public.pinlvs,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),"month"==e.pinlv?a("el-form-item",{attrs:{label:"日期"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.cjobs},model:{value:e.day,callback:function(t){e.day=t},expression:"day"}},e._l(e.$public.days,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"week"==e.pinlv?a("el-form-item",{attrs:{label:"周"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.cjobs},model:{value:e.week,callback:function(t){e.week=t},expression:"week"}},e._l(e.$public.weeks,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),a("el-form-item",{attrs:{label:"时间点"}},[a("el-time-picker",{attrs:{placeholder:"任意时间点","value-format":"H m s"},on:{change:e.createjobs},model:{value:e.times,callback:function(t){e.times=t},expression:"times"}})],1),a("el-form-item",{attrs:{label:"计划任务",prop:"crontab",rules:[{required:!0,message:"请输入 计划任务",trigger:"blur"}]}},[a("el-input",{model:{value:e.taskform.crontab,callback:function(t){e.$set(e.taskform,"crontab",t)},expression:"taskform.crontab"}})],1),a("el-form-item",{attrs:{label:"本地备份保留数"}},[a("el-input-number",{attrs:{min:1,max:100},model:{value:e.taskform.expire,callback:function(t){e.$set(e.taskform,"expire",t)},expression:"taskform.expire"}}),e._v("个 ")],1),a("el-form-item",[a("el-button",{attrs:{type:"success"},on:{click:e.edittask}},[e._v("修改")])],1)],1)],1)],1)],1),e.dialogDirVisible?a("el-dialog",{attrs:{title:"请选择",visible:e.dialogDirVisible},on:{"update:visible":function(t){e.dialogDirVisible=t}}},[a("dirlist",{attrs:{dialogDirVisible:e.dialogDirVisible,"key-name":e.keyName},on:{close:e.changeDir}})],1):e._e()],1)},m=[],f=(a("b0c0"),a("9794")),h={components:{Dirlist:f["a"]},props:{flush:{type:Function,default:function(){}}},data:function(){return{drawer:!1,dialogDirVisible:!1,keyName:"",taskform:{dbtype:"file",crontab:"",rs:[],pause:0,expire:1},day:"1",week:"1",times:"",pinlv:"day",enablezippwd:!1,remotestorages:[],rowid:""}},methods:{open:function(e){this.ftpGet(),e&&(this.rowid=e,this.GetOneTask(this.rowid)),this.drawer=!0},changeDir:function(e){this.taskform[e.name]=e.value,this.dialogDirVisible=!1},enableDirSearch:function(e){this.keyName=e,this.dialogDirVisible=!0},ftpGet:function(){var e=this;this.$http.Get(this.$api.ftps,{page:1,count:-1},(function(t){e.remotestorages=t.data}))},changepinlv:function(e){this.pinlv=e,this.cjobs()},createjobs:function(e){this.times=e,this.cjobs()},edittask:function(){var e=this;this.$http.Put(this.$api.task+"/"+this.taskform.id,this.taskform,(function(){e.flush(),e.drawer=!1}),"修改任务")},cjobs:function(){var e=this.times.split(" "),t="";3===e.length&&(t=e[2]+" "+e[1]+" "+e[0],"month"===this.pinlv&&this.day?t=t+" "+this.day+" * *":"week"===this.pinlv&&this.week?t=t+" * * "+this.week:t+=" * * *"),this.taskform.crontab=t},GetOneTask:function(e){var t=this;this.$http.Get(this.$api.task+"/"+e,{},(function(e){t.taskform=e}))}}},b=h,k=Object(c["a"])(b,d,m,!1,null,null,null),v=k.exports,g={components:{AddTask:u,EditTask:v},data:function(){return{formType:"file",dialogFormVisible:!1,AddTaskTitle:!1,dialogDirVisible:!1,tasks:[],editTaskId:"",total:0,currentPage:1,pageSize:10,formLabelWidth:"120px",query:{pageSize:15,currentPage:1,name:"",selectTypes:"file",dbname:""}}},created:function(){this.taskGet()},methods:{deleteTask:function(e){var t=this;this.$confirm("此操作将永久删除该任务, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$http.Delete(t.$api.task+"/"+e,{},(function(){t.taskGet()}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},search:function(){this.query.currentPage=1,this.taskGet()},current_change:function(e){this.query.currentPage=e,this.taskGet()},runJob:function(e){this.$http.Put(this.$api.runjob+"/"+e,{},(function(){}),"立即执行任务")},edit:function(e){this.$refs.EditTask.open(e)},taskGet:function(){var e=this;this.$http.Get(this.$api.tasks,this.query,(function(t){e.tasks=t.data,e.total=t.count}))}}},w=g,_=(a("150a"),Object(c["a"])(w,s,i,!1,null,null,null));t["default"]=_.exports},"150a":function(e,t,a){"use strict";a("20d2")},"20d2":function(e,t,a){},9794:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"mydiv"},[a("el-tree",{ref:"tree",attrs:{props:e.props,load:e.loadNode,"check-on-click-node":!0,lazy:"","node-key":"path","show-checkbox":"","check-strictly":!0},on:{check:e.nodeClick}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.clickDirPath}},[e._v("确 定")])],1)])},i=[],l={props:{keyName:{type:String,default:""}},data:function(){return{input:"",props:{label:"label",children:"children",isLeaf:"isLeaf",path:"path"}}},methods:{clickDirPath:function(){var e={name:this.keyName,value:this.input};this.$emit("close",e)},loadNode:function(e,t){0===e.level?this.$http.Get(this.$api.dirlist,{},(function(e){return t(e)})):this.$http.Get(this.$api.dirlist,{dir:e.data.path},(function(e){return t(e)}))},nodeClick:function(e){this.$refs.tree.setCheckedNodes([e]),this.input=e.path}}},r=l,n=a("2877"),o=Object(n["a"])(r,s,i,!1,null,null,null);t["a"]=o.exports}}]);