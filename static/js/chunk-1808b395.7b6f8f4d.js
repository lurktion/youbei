(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1808b395"],{5538:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",[a("el-main",[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:10}},[a("el-form",{ref:"ruleForm",attrs:{model:e.formData,"label-width":"120px",size:"mini","label-position":"right"}},[a("el-alert",{attrs:{title:"提示:当前远程备份只支持ssh远程和mysql数据库",type:"warning",center:"","show-icon":""}}),a("el-divider",[e._v("SSH配置")]),a("el-form-item",{attrs:{label:"主机地址",prop:"host",rules:[{required:!0,message:"请输入主机地址",trigger:"blur"}]}},[a("el-input",{attrs:{placeholder:"主机地址"},model:{value:e.formData.host,callback:function(t){e.$set(e.formData,"host",t)},expression:"formData.host"}})],1),a("el-form-item",{attrs:{label:"SSH端口",prop:"sshport",rules:[{required:!0,message:"请输入SSH端口",trigger:"blur"}]}},[a("el-input",{attrs:{placeholder:"端口"},model:{value:e.formData.sshport,callback:function(t){e.$set(e.formData,"sshport",t)},expression:"formData.sshport"}})],1),a("el-form-item",{attrs:{label:"SSH用户名",prop:"sshuser",rules:[{required:!0,message:"请输入SSH用户名",trigger:"blur"}]}},[a("el-input",{attrs:{placeholder:"用户名"},model:{value:e.formData.sshuser,callback:function(t){e.$set(e.formData,"sshuser",t)},expression:"formData.sshuser"}})],1),a("el-form-item",{attrs:{label:"SSH密码",prop:"sshpwd",rules:[{required:!0,message:"请输入SSH密码",trigger:"blur"}]}},[a("el-input",{attrs:{placeholder:"密码"},model:{value:e.formData.sshpwd,callback:function(t){e.$set(e.formData,"sshpwd",t)},expression:"formData.sshpwd"}})],1),a("el-divider",[e._v("MySQL配置")]),a("el-form-item",{attrs:{label:"SQL主机地址",prop:"dbhost",rules:[{required:!0,message:"请输入SQL主机地址",trigger:"blur"}]}},[a("el-input",{attrs:{placeholder:"主机地址"},model:{value:e.formData.dbhost,callback:function(t){e.$set(e.formData,"dbhost",t)},expression:"formData.dbhost"}})],1),a("el-form-item",{attrs:{label:"SQL端口",prop:"dbport",rules:[{required:!0,message:"请输入SQL端口",trigger:"blur"}]}},[a("el-input",{attrs:{placeholder:"端口"},model:{value:e.formData.dbport,callback:function(t){e.$set(e.formData,"dbport",t)},expression:"formData.dbport"}})],1),a("el-form-item",{attrs:{label:"SQL用户名",prop:"dbuser",rules:[{required:!0,message:"请输入SQL用户名",trigger:"blur"}]}},[a("el-input",{attrs:{placeholder:"用户名"},model:{value:e.formData.dbuser,callback:function(t){e.$set(e.formData,"dbuser",t)},expression:"formData.dbuser"}})],1),a("el-form-item",{attrs:{label:"SQL密码",prop:"dbpwd",rules:[{required:!0,message:"请输入SQL密码",trigger:"blur"}]}},[a("el-input",{attrs:{placeholder:"密码"},model:{value:e.formData.dbpwd,callback:function(t){e.$set(e.formData,"dbpwd",t)},expression:"formData.dbpwd"}})],1),a("el-form-item",{attrs:{label:"数据库名",prop:"dbname",rules:[{required:!0,message:"请输入数据库名",trigger:"blur"}]}},[a("el-input",{attrs:{placeholder:"数据库名"},model:{value:e.formData.dbname,callback:function(t){e.$set(e.formData,"dbname",t)},expression:"formData.dbname"}})],1),a("el-divider",[e._v("任务配置")]),a("el-form-item",{attrs:{label:"本地保存"}},[a("el-switch",{attrs:{"active-text":"保存","inactive-text":"不保存"},on:{change:e.savepathfunc},model:{value:e.localsave,callback:function(t){e.localsave=t},expression:"localsave"}})],1),e.localsave?a("div",[a("el-form-item",{attrs:{label:"存储路径"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.formData.savepath,callback:function(t){e.$set(e.formData,"savepath",t)},expression:"formData.savepath"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){return e.enableDirSearch("savepath")}},slot:"append"})],1)],1),a("el-form-item",{attrs:{label:"是否加密"}},[a("el-switch",{model:{value:e.enablezippwd,callback:function(t){e.enablezippwd=t},expression:"enablezippwd"}})],1),e.enablezippwd?a("el-form-item",{attrs:{label:"压缩密码"}},[a("el-input",{attrs:{"show-password":""},model:{value:e.formData.zippwd,callback:function(t){e.$set(e.formData,"zippwd",t)},expression:"formData.zippwd"}})],1):e._e(),a("el-form-item",{attrs:{label:"异地存储"}},[a("el-select",{attrs:{multiple:""},model:{value:e.formData.rs,callback:function(t){e.$set(e.formData,"rs",t)},expression:"formData.rs"}},e._l(e.remotestorages,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1):e._e(),a("el-form-item",{attrs:{label:"执行频率"}},[a("el-select",{on:{change:e.changepinlv},model:{value:e.pinlv,callback:function(t){e.pinlv=t},expression:"pinlv"}},e._l(e.$public.pinlvs,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),"month"==e.pinlv?a("el-form-item",{attrs:{label:"日期"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.cjobs},model:{value:e.day,callback:function(t){e.day=t},expression:"day"}},e._l(e.$public.days,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"week"==e.pinlv?a("el-form-item",{attrs:{label:"周"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.cjobs},model:{value:e.week,callback:function(t){e.week=t},expression:"week"}},e._l(e.$public.weeks,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),a("el-form-item",{attrs:{label:"时间点"}},[a("el-time-picker",{attrs:{placeholder:"任意时间点","value-format":"H m s"},on:{change:e.createjobs},model:{value:e.times,callback:function(t){e.times=t},expression:"times"}})],1),a("el-form-item",{attrs:{label:"计划任务",prop:"crontab",rules:[{required:!0,message:"请输入 计划任务",trigger:"blur"}]}},[a("el-input",{model:{value:e.formData.crontab,callback:function(t){e.$set(e.formData,"crontab",t)},expression:"formData.crontab"}})],1),e.localsave?a("el-form-item",{attrs:{label:"本地备份保留数"}},[a("el-input-number",{attrs:{min:1,max:100},model:{value:e.formData.expire,callback:function(t){e.$set(e.formData,"expire",t)},expression:"formData.expire"}})],1):e._e(),a("el-form-item",{attrs:{label:""}},[""==e.taskId?a("el-button",{attrs:{type:"primary"},on:{click:e.addsshtask}},[e._v("添加")]):a("el-button",{attrs:{type:"primary"},on:{click:e.updatesshtask}},[e._v("修改")])],1)],1)],1)],1),e.dialogDirVisible?a("el-dialog",{attrs:{title:"请选择",visible:e.dialogDirVisible,width:"30%","append-to-body":""},on:{"update:visible":function(t){e.dialogDirVisible=t}}},[a("dirlist",{attrs:{dialogDirVisible:e.dialogDirVisible,"key-name":e.keyName},on:{close:e.changeDir}})],1):e._e()],1)],1)},r=[],s=(a("b0c0"),a("9794")),i={components:{Dirlist:s["a"]},data:function(){return{formData:{crontab:"",expire:1},localsave:!1,keyName:"",dialogDirVisible:!1,enablezippwd:!1,remotestorages:[],day:"1",week:"1",times:"",pinlv:"day",taskId:""}},created:function(){this.$route.query.id&&(this.taskId=this.$route.query.id,this.getsshtask(this.taskId)),this.ftpGet()},methods:{getsshtask:function(e){var t=this;this.$http.Get(this.$api.sshtask+"/"+e,{},(function(e){""===e.savepath?t.localsave=!1:t.localsave=!0,""===t.zippwd?t.enablezippwd=!1:t.enablezippwd=!0,t.formData=e}))},savepathfunc:function(e){e||(this.formData.savepath="")},createjobs:function(e){this.times=e,this.cjobs()},changeDir:function(e){this.formData[e.name]=e.value,this.dialogDirVisible=!1},enableDirSearch:function(e){this.keyName=e,this.dialogDirVisible=!0},ftpGet:function(){var e=this;this.$http.Get(this.$api.ftps,{page:1,count:-1},(function(t){e.remotestorages=t.data}))},changepinlv:function(e){this.pinlv=e,this.cjobs()},cjobs:function(){var e=this.times.split(" "),t="";3===e.length&&(t=e[2]+" "+e[1]+" "+e[0],"month"===this.pinlv&&this.day?t=t+" "+this.day+" * *":"week"===this.pinlv&&this.week?t=t+" * * "+this.week:t+=" * * *"),this.formData.crontab=t},addsshtask:function(){var e=this;this.$refs["ruleForm"].validate((function(t){if(!t)return!1;e.$http.Post(e.$api.sshtask,e.formData,(function(){e.$router.go(-1)}))}))},updatesshtask:function(){var e=this;!1===this.localsave&&(this.formData.rs=[],this.formData.savepath="",this.formData.zippwd=""),this.$refs["ruleForm"].validate((function(t){if(!t)return!1;e.$http.Put(e.$api.sshtask+"/"+e.taskId,e.formData,(function(){e.$router.go(-1)}))}))}}},o=i,n=a("2877"),c=Object(n["a"])(o,l,r,!1,null,null,null);t["default"]=c.exports},9794:function(e,t,a){"use strict";var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"mydiv"},[a("el-tree",{ref:"tree",attrs:{props:e.props,load:e.loadNode,"check-on-click-node":!0,lazy:"","node-key":"path","show-checkbox":"","check-strictly":!0},on:{check:e.nodeClick}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.clickDirPath}},[e._v("确 定")])],1)])},r=[],s={props:{keyName:{type:String,default:""}},data:function(){return{input:"",props:{label:"label",children:"children",isLeaf:"isLeaf",path:"path"}}},methods:{clickDirPath:function(){var e={name:this.keyName,value:this.input};this.$emit("close",e)},loadNode:function(e,t){0===e.level?this.$http.Get(this.$api.dirlist,{},(function(e){return t(e)})):this.$http.Get(this.$api.dirlist,{dir:e.data.path},(function(e){return t(e)}))},nodeClick:function(e){this.$refs.tree.setCheckedNodes([e]),this.input=e.path}}},i=s,o=a("2877"),n=Object(o["a"])(i,l,r,!1,null,null,null);t["a"]=n.exports}}]);