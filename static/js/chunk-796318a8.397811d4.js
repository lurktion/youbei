(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-796318a8"],{7156:function(e,t,s){var i=s("861d"),a=s("d2bb");e.exports=function(e,t,s){var r,l;return a&&"function"==typeof(r=t.constructor)&&r!==s&&i(l=r.prototype)&&l!==s.prototype&&a(e,l),e}},9794:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"mydiv"},[s("el-tree",{ref:"tree",attrs:{props:e.props,load:e.loadNode,"check-on-click-node":!0,lazy:"","node-key":"path","show-checkbox":"","check-strictly":!0},on:{check:e.nodeClick}})],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.clickDirPath}},[e._v("确 定")])],1)])},a=[],r={props:{keyName:{type:String,default:""}},data:function(){return{input:"",props:{label:"label",children:"children",isLeaf:"isLeaf",path:"path"}}},methods:{clickDirPath:function(){var e={name:this.keyName,value:this.input};this.$emit("close",e)},loadNode:function(e,t){0===e.level?this.$http.Get(this.$api.dirlist,{},(function(e){return t(e)})):this.$http.Get(this.$api.dirlist,{dir:e.data.path},(function(e){return t(e)}))},nodeClick:function(e){this.$refs.tree.setCheckedNodes([e]),this.input=e.path}}},l=r,o=s("2877"),n=Object(o["a"])(l,i,a,!1,null,null,null);t["a"]=n.exports},a9e3:function(e,t,s){"use strict";var i=s("83ab"),a=s("da84"),r=s("94ca"),l=s("6eeb"),o=s("5135"),n=s("c6b6"),c=s("7156"),p=s("c04e"),u=s("d039"),d=s("7c73"),f=s("241c").f,m=s("06cf").f,b=s("9bf2").f,h=s("58a8").trim,g="Number",k=a[g],v=k.prototype,y=n(d(v))==g,_=function(e){var t,s,i,a,r,l,o,n,c=p(e,!1);if("string"==typeof c&&c.length>2)if(c=h(c),t=c.charCodeAt(0),43===t||45===t){if(s=c.charCodeAt(2),88===s||120===s)return NaN}else if(48===t){switch(c.charCodeAt(1)){case 66:case 98:i=2,a=49;break;case 79:case 111:i=8,a=55;break;default:return+c}for(r=c.slice(2),l=r.length,o=0;o<l;o++)if(n=r.charCodeAt(o),n<48||n>a)return NaN;return parseInt(r,i)}return+c};if(r(g,!k(" 0o1")||!k("0b1")||k("+0x1"))){for(var w,$=function(e){var t=arguments.length<1?0:e,s=this;return s instanceof $&&(y?u((function(){v.valueOf.call(s)})):n(s)!=g)?c(new k(_(t)),s,$):_(t)},q=i?f(k):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),x=0;q.length>x;x++)o(k,w=q[x])&&!o($,w)&&b($,w,m(k,w));$.prototype=v,v.constructor=$,l(a,g,$)}},ef1a:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-container",[s("el-main",[s("el-row",[s("el-col",{attrs:{span:22,offset:1}},[s("el-card",[s("div",{staticClass:"indexbtngroup"},[s("div",{staticClass:"indexbtn"},[s("AddTask",{ref:"AddTask",attrs:{flush:e.taskGet}})],1),s("div",{staticClass:"indexbtn"},[s("cmds",{ref:"cmds"})],1)])])],1)],1),s("el-row",[s("el-col",{attrs:{span:22,offset:1}},[s("el-table",{attrs:{data:e.tasks,border:"",size:"mini"}},[s("el-table-column",{attrs:{label:"编号",prop:"name",width:"150"}}),s("el-table-column",{attrs:{prop:"dbtype",label:"数据库类型",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:"primary",size:"mini"}},[e._v(e._s(t.row.dbtype))])]}}])}),s("el-table-column",{attrs:{prop:"dbname",label:"数据库"},scopedSlots:e._u([{key:"default",fn:function(t){return["mysql"==t.row.dbtype||"mssql"==t.row.dbtype||"postgres"==t.row.dbtype||"mongodb"==t.row.dbtype?s("span",[e._v(e._s(t.row.dbname))]):e._e(),"sqlite"==t.row.dbtype?s("span",[e._v(e._s(t.row.dbpath))]):e._e()]}}])}),s("el-table-column",{attrs:{prop:"crontab",label:"计划任务",width:"140"}}),s("el-table-column",{attrs:{prop:"savepath",label:"保存地址"}}),s("el-table-column",{attrs:{prop:"created",label:"创建时间",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(e.$public.comTime(t.row.created)))])]}}])}),s("el-table-column",{attrs:{prop:"status",label:"操作",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-link",{attrs:{type:"warning",underline:!1},on:{click:function(s){return e.runJob(t.row.id)}}},[e._v("手动执行")]),s("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(s){return e.edit(t.row.id)}}},[e._v("修改")]),s("el-link",{attrs:{type:"danger",underline:!1},on:{click:function(s){return e.deleteTask(t.row.id)}}},[e._v("删除")])]}}])})],1),s("div",{staticClass:"block"},[s("el-pagination",{attrs:{small:!0,background:"","page-size":e.pageSize,"page-count":e.currentPage,layout:"prev, pager, next",total:e.total},on:{"current-change":e.current_change}})],1)],1)],1),s("EditTask",{ref:"EditTask",attrs:{flush:e.taskGet}})],1)],1)},a=[],r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-button",{attrs:{size:"mini"},on:{click:e.addForm}},[e._v("添加任务")]),s("el-dialog",{attrs:{title:"新建任务",visible:e.NewTaskDialog,modal:!1,width:"80%"},on:{"update:visible":function(t){e.NewTaskDialog=t}}},[s("el-row",[s("el-col",{attrs:{span:22,offset:1}},[s("el-steps",{attrs:{active:e.step,"finish-status":"success",simple:""}},[s("el-step",{attrs:{title:"1.数据库信息"}}),s("el-step",{attrs:{title:"2.数据存储信息"}}),s("el-step",{attrs:{title:"3.任务配置"}}),s("el-step",{attrs:{title:"3.确认"}})],1)],1)],1),s("el-row",{directives:[{name:"show",rawName:"v-show",value:0===e.step,expression:"step === 0"}]},[s("el-col",{attrs:{span:10,offset:4}},[s("baseView",{ref:"baseView",attrs:{flush:e.stepPlus}})],1)],1),s("el-row",{directives:[{name:"show",rawName:"v-show",value:1===e.step,expression:"step === 1"}]},[s("el-col",{attrs:{span:10,offset:4}},[s("saveView",{ref:"saveView",attrs:{taskinfo:e.taskinfo,stepCut:e.stepCut,flush:e.stepPlus}})],1)],1),s("el-row",{directives:[{name:"show",rawName:"v-show",value:2===e.step,expression:"step === 2"}]},[s("el-col",{attrs:{span:10,offset:4}},[s("jobView",{ref:"jobView",attrs:{flush:e.stepPlus,stepCut:e.stepCut,taskinfo:e.taskinfo}})],1)],1),3===e.step?s("el-row",[s("el-col",{attrs:{span:22,offset:1}},[s("el-descriptions",{staticStyle:{"margin-top":"15px"},attrs:{title:"数据库信息",border:"",size:"mini",direction:"vertical"}},[s("el-descriptions-item",{attrs:{label:"数据库类型"}},[e._v(e._s(e.taskinfo.dbtype))]),"sqlite"!==e.taskinfo.dbtype?s("el-descriptions-item",{attrs:{label:"SQL地址"}},[e._v(e._s(e.taskinfo.host))]):e._e(),"sqlite"!==e.taskinfo.dbtype?s("el-descriptions-item",{attrs:{label:"SQL端口"}},[e._v(e._s(e.taskinfo.port))]):e._e(),"sqlite"!==e.taskinfo.dbtype?s("el-descriptions-item",{attrs:{label:"SQL用户名"}},[e._v(e._s(e.taskinfo.user))]):e._e(),"sqlite"!==e.taskinfo.dbtype?s("el-descriptions-item",{attrs:{label:"SQL密码"}},[e._v(e._s(e.taskinfo.password))]):e._e(),e.$public.checkValueInArr(e.taskinfo.dbtype,["mysql","mssql","postgres","mongodb"])?s("el-descriptions-item",{attrs:{label:"数据库"}},e._l(e.taskinfo.dbnames,(function(t){return s("el-tag",{key:t,staticStyle:{"margin-right":"5px"},attrs:{size:"mini"}},[e._v(e._s(t))])})),1):s("el-descriptions-item",{attrs:{label:"数据库路径"}},[e._v(e._s(e.taskinfo.dbpath))])],1),s("el-descriptions",{staticStyle:{"margin-top":"15px"},attrs:{title:"本地保存目录",border:"",size:"mini",direction:"vertical"}},[s("el-descriptions-item",{attrs:{label:"本地保存目录"}},[e._v(e._s(e.taskinfo.savepath))]),s("el-descriptions-item",{attrs:{label:"是否有压缩密码"}},[e._v(e._s(0===e.taskinfo.enablezippwd?"否":"是"))]),1===e.taskinfo.enablezippwd?s("el-descriptions-item",{attrs:{label:"压缩密码"}},[e._v(e._s(e.taskinfo.zippwd))]):e._e()],1),s("el-descriptions",{staticStyle:{"margin-top":"15px"},attrs:{title:"任务配置",border:"",size:"mini",direction:"vertical"}},[e.taskinfo.rs&&e.taskinfo.rs.length>0?s("el-descriptions-item",{attrs:{label:"异地存储"}},[s("el-select",{attrs:{multiple:"",disabled:"",size:"mini"},model:{value:e.taskinfo.rs,callback:function(t){e.$set(e.taskinfo,"rs",t)},expression:"taskinfo.rs"}},e._l(e.remotestorages,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),s("el-descriptions-item",{attrs:{label:"执行频率"}},[e._v(e._s(e.$public.pinlvFmt(e.$refs.jobView.pinlv)))]),"month"===e.$refs.jobView.pinlv?s("el-descriptions-item",{attrs:{label:"日期"}},[e._v(e._s(e.day))]):e._e(),"week"===e.$refs.jobView.pinlvpinlv?s("el-descriptions-item",{attrs:{label:"周"}},[e._v(e._s(e.week))]):e._e(),s("el-descriptions-item",{attrs:{label:"时间点"}},[e._v(e._s(e.$public.timesFmt(e.$refs.jobView.times)))]),s("el-descriptions-item",{attrs:{label:"计划任务"}},[e._v(e._s(e.taskinfo.crontab))]),s("el-descriptions-item",{attrs:{label:"本地备份保留数"}},[e._v(e._s(e.taskinfo.expire))])],1)],1),s("el-col",{staticStyle:{"margin-top":"15px"},attrs:{span:22,offset:1}},[3===e.step?s("el-button",{attrs:{size:"mini"},on:{click:e.stepCut}},[e._v("上一步")]):e._e(),s("el-button",{attrs:{type:"success",size:"mini"},on:{click:e.addtask}},[e._v("确定")])],1)],1):e._e()],1)],1)},l=[],o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-form",{ref:"form",attrs:{model:e.form,size:"mini",rules:e.rules,"label-width":"180px","validate-on-rule-change":!1}},[s("el-form-item",{attrs:{label:"备份对象类型",prop:"types"}},[[s("div",{staticStyle:{float:"left"}},[s("el-select",{attrs:{placeholder:"选择备份对象类型"},on:{change:e.changetypes},model:{value:e.form.types,callback:function(t){e.$set(e.form,"types",t)},expression:"form.types"}},e._l(e.$public.tasktypes,(function(e,t){return s("el-option",{key:t+"types",attrs:{value:e.value,label:e.label}})})),1)],1),s("div",{staticStyle:{float:"left","margin-left":"5px"}},[s("el-popover",{attrs:{placement:"top-start",title:"注意事项",trigger:"hover",content:"备份对象涉及到sqlcmd命令是否支持远程存储，只有本机sqlcmd导出的文件可以进行远程存储"}},[s("el-link",{attrs:{slot:"reference",underline:!1,type:"warning",icon:"el-icon-info"},slot:"reference"})],1)],1)]],2),s("el-form-item",{attrs:{label:"数据库类型",prop:"dbtype"}},[s("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){e.form.cmds=""}},model:{value:e.form.dbtype,callback:function(t){e.$set(e.form,"dbtype",t)},expression:"form.dbtype"}},e._l(e.$public.sqltypes,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),"sqlite"!==e.form.dbtype?s("el-form-item",{attrs:{label:"备份命令",prop:"cmds"}},[[s("div",{staticStyle:{float:"left"}},[s("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.form.cmds,callback:function(t){e.$set(e.form,"cmds",t)},expression:"form.cmds"}},e._l(e.cmds,(function(t,i){return s("el-option",{key:i+"cmds",attrs:{label:t.name,value:t.id,disabled:0!==t.status||t.dbtype!=e.form.dbtype}})})),1)],1),s("div",{staticStyle:{float:"left","margin-left":"5px"}},[s("el-popover",{attrs:{placement:"top-start",title:"注意事项",trigger:"hover",content:"不选择备份命令，默认将使用xorm的dump功能,目前此功能支持 mysql / mssql / pgsql / sqlite3"}},[s("el-link",{attrs:{slot:"reference",underline:!1,type:"warning",icon:"el-icon-info"},slot:"reference"})],1)],1)]],2):e._e(),0===e.form.types&&e.$public.checkValueInArr(e.form.dbtype,["mysql","mssql","postgres","mongodb"])?s("el-form-item",{attrs:{label:"SQL地址",prop:"host"}},[s("el-select",{attrs:{placeholder:"SQL地址"},model:{value:e.form.host,callback:function(t){e.$set(e.form,"host",t)},expression:"form.host"}},e._l(e.hosts,(function(e,t){return s("el-option",{key:t+"hosts",attrs:{label:e,value:e}})})),1)],1):e._e(),1===e.form.types&&e.$public.checkValueInArr(e.form.dbtype,["mysql","mssql","postgres","mongodb"])?s("el-form-item",{attrs:{label:"SQL地址",prop:"host"}},[s("el-input",{model:{value:e.form.host,callback:function(t){e.$set(e.form,"host",t)},expression:"form.host"}})],1):e._e(),e.$public.checkValueInArr(e.form.dbtype,["mysql","mssql","postgres","mongodb"])?s("el-form-item",{attrs:{label:"SQL端口",prop:"port"}},[s("el-input",{model:{value:e.form.port,callback:function(t){e.$set(e.form,"port",t)},expression:"form.port"}})],1):e._e(),e.$public.checkValueInArr(e.form.dbtype,["mysql","mssql","postgres","mongodb"])?s("el-form-item",{attrs:{label:"SQL用户名",prop:"user"}},[s("el-input",{model:{value:e.form.user,callback:function(t){e.$set(e.form,"user",t)},expression:"form.user"}})],1):e._e(),e.$public.checkValueInArr(e.form.dbtype,["mysql","mssql","postgres","mongodb"])?s("el-form-item",{attrs:{label:"SQL密码",prop:"password"}},[s("el-input",{attrs:{"show-password":""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1):e._e(),e.$public.checkValueInArr(e.form.dbtype,["postgres"])?s("el-form-item",{attrs:{label:"PG默认库",prop:"defdbname"}},[s("el-input",{model:{value:e.form.defdbname,callback:function(t){e.$set(e.form,"defdbname",t)},expression:"form.defdbname"}})],1):e._e(),"mysql"===e.form.dbtype?s("el-form-item",{attrs:{label:"字符编码"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.char,callback:function(t){e.$set(e.form,"char",t)},expression:"form.char"}},e._l(e.$public.chars,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),e.$public.checkValueInArr(e.form.dbtype,["mysql","mssql","postgres","mongodb"])?s("el-form-item",{attrs:{label:"数据库名",prop:"dbnames"}},[s("el-button",{attrs:{type:"success"},on:{click:e.getdb}},[e._v("选择数据库")]),e.form.dbnames.length>0?s("ul",e._l(e.form.dbnames,(function(t){return s("li",{key:t},[e._v(e._s(t))])})),0):e._e()],1):e._e(),"sqlite"===e.form.dbtype?s("el-form-item",{attrs:{label:"数据库路径",prop:"dbpath"}},[s("el-tree",{key:"dbpath",ref:"dbpath",attrs:{props:e.srcprops,load:e.srcloadNode,"check-on-click-node":!0,lazy:"","node-key":"path","show-checkbox":"","check-strictly":!0},on:{check:e.srcnodeClick}})],1):e._e(),s("el-form-item",{attrs:{label:""}},[s("el-button",{on:{click:e.submit}},[e._v("下一步")])],1)],1),s("el-dialog",{attrs:{title:"选择数据库",visible:e.dialogTableVisible,"append-to-body":"",width:"30%",modal:!1},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[s("el-form",{attrs:{model:e.dbnamesform,size:"mini"}},[s("el-form-item",{attrs:{label:""}},[s("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:e.dbnamesform.changedbnames,callback:function(t){e.$set(e.dbnamesform,"changedbnames",t)},expression:"dbnamesform.changedbnames"}},e._l(e.dbnames,(function(e,t){return s("el-option",{key:t+"dbnames",attrs:{label:e,value:e}})})),1)],1)],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogTableVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.submitdbnames}},[e._v("确 定")])],1)],1)],1)},n=[],c=(s("a9e3"),{props:{flush:{type:Function,default:function(){}}},data:function(){return{form:{types:0,dbtype:"mysql",host:"",char:"utf8",port:"",dbnames:[],cmds:"",user:""},cmds:[],hosts:[],dialogTableVisible:!1,dbnames:[],srcprops:{label:"label",children:"children",isLeaf:"isLeaf",path:"path"},dbnamesform:{changedbnames:[]}}},computed:{rules:function(e){var t=e.form;if("mysql"===t.dbtype){var s={types:[{required:!0,message:"请选择类型名称",trigger:"change"}],dbtype:[{required:!0,message:"请选择类型名称",trigger:"blur"}],host:[{required:!0,message:"请选择类型名称",trigger:"change"}],port:[{required:!0,message:"请输入主机端口",trigger:"blur"},{type:"number",message:"必须为数字",trigger:"blur",transform:function(e){return Number(e)}}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],user:[{required:!0,message:"请输入用户名",trigger:"blur"}],dbnames:[{required:!0,message:"请输入数据库名",trigger:"blur"}],savepath:[{required:!0,message:"请输入保存路径",trigger:"blur"}]};return s}if("mssql"===t.dbtype){var i={types:[{required:!0,message:"请选择类型名称",trigger:"change"}],dbtype:[{required:!0,message:"请选择类型名称",trigger:"blur"}],host:[{required:!0,message:"请选择类型名称",trigger:"change"}],port:[{required:!0,message:"请输入主机端口",trigger:"blur"},{type:"number",message:"必须为数字",trigger:"blur",transform:function(e){return Number(e)}}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],user:[{required:!0,message:"请输入用户名",trigger:"blur"}],dbnames:[{required:!0,message:"请输入数据库名",trigger:"blur"}],savepath:[{required:!0,message:"请输入保存路径",trigger:"blur"}]};return 1===t.types&&(i.host=[{required:!0,message:"请选择类型名称",trigger:"blur"}]),i}if("postgres"===t.dbtype){var a={types:[{required:!0,message:"请选择类型名称",trigger:"change"}],dbtype:[{required:!0,message:"请选择类型名称",trigger:"blur"}],host:[{required:!0,message:"请选择类型名称",trigger:"change"}],port:[{required:!0,message:"请输入主机端口",trigger:"blur"},{type:"number",message:"必须为数字",trigger:"blur",transform:function(e){return Number(e)}}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],user:[{required:!0,message:"请输入用户名",trigger:"blur"}],defdbname:[{required:!0,message:"请输入默认库名称",trigger:"blur"}],dbnames:[{required:!0,message:"请输入数据库名",trigger:"blur"}]};return a}if("mongodb"===t.dbtype){var r={types:[{required:!0,message:"请选择类型名称",trigger:"change"}],dbtype:[{required:!0,message:"请选择类型名称",trigger:"blur"}],host:[{required:!0,message:"请选择类型名称",trigger:"change"}],port:[{required:!0,message:"请输入主机端口",trigger:"blur"},{type:"number",message:"必须为数字",trigger:"blur",transform:function(e){return Number(e)}}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],user:[{required:!0,message:"请输入用户名",trigger:"blur"}],defdbname:[{required:!0,message:"请输入默认库名称",trigger:"blur"}],dbnames:[{required:!0,message:"请输入数据库名",trigger:"blur"}]};return r}if("sqlite"===t.dbtype){var l={types:[{required:!0,message:"请选择类型名称",trigger:"change"}],dbtype:[{required:!0,message:"请选择类型名称",trigger:"blur"}],dbpath:[{required:!0,message:"请选择数据库路径",trigger:"blur"}]};return l}return{types:[{required:!0,message:"请选择类型名称",trigger:"change"}],dbtype:[{required:!0,message:"请选择类型名称",trigger:"blur"}]}}},methods:{srcnodeClick:function(e){this.$refs.dbpath.setCheckedNodes([e]),this.taskinfo.dbpath=e.path},submitdbnames:function(){this.form["dbnames"]=this.dbnamesform.changedbnames,this.dialogTableVisible=!1},defget:function(){this.getcmds(),this.getlocalip()},submit:function(){var e=this;this.$refs["form"].validate((function(t){if(!t)return console.log("error submit!!"),!1;e.flush(e.form)}))},changetypes:function(e){this.form.host="",0===e&&this.getlocalip()},getlocalip:function(){var e=this;this.$http.Get(this.$api.getlocal,{},(function(t){e.hosts=t}))},getcmds:function(){var e=this;this.$http.Get(this.$api.getcmds,{},(function(t){e.cmds=t}))},getdb:function(){var e=this;this.$http.Get(this.$api.getdbinfo,{User:this.form.user,Password:this.form.password,Host:this.form.host,Port:this.form.port,Char:this.form.char,Dbtype:this.form.dbtype,Defdbname:this.form.defdbname},(function(t){e.dbnames=t,e.dialogTableVisible=!0}))},srcloadNode:function(e,t){0===e.level?this.$http.Get(this.$api.dirlist,{},(function(e){return t(e)})):this.$http.Get(this.$api.dirlist,{dir:e.data.path,isdir:!1},(function(e){return t(e)}))}}}),p=c,u=s("2877"),d=Object(u["a"])(p,o,n,!1,null,null,null),f=d.exports,m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-form",{ref:"form",attrs:{model:e.form,size:"mini",rules:e.rules,"label-width":"180px"}},["mssql"!==e.taskinfo.dbtype||""===e.taskinfo.cmds||1!==e.taskinfo.types?s("el-form-item",{attrs:{label:"本地保存路径",prop:"savepath"}},[s("el-tree",{key:"savepath",ref:"savepath",attrs:{props:e.props,load:e.loadNode,"check-on-click-node":!0,lazy:"","node-key":"path","show-checkbox":"","check-strictly":!0},on:{check:e.nodeClick}})],1):e._e(),"mssql"!==e.taskinfo.dbtype||""===e.taskinfo.cmds||1!==e.taskinfo.types?s("el-form-item",{attrs:{label:"是否加密"}},[s("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.form.enablezippwd,callback:function(t){e.$set(e.form,"enablezippwd",t)},expression:"form.enablezippwd"}})],1):e._e(),1!==e.form.enablezippwd||"mssql"===e.taskinfo.dbtype&&""!==e.taskinfo.cmds&&1===e.taskinfo.types?e._e():s("el-form-item",{attrs:{label:"压缩密码",prop:"zippwd"}},[s("el-input",{attrs:{"show-password":""},model:{value:e.form.zippwd,callback:function(t){e.$set(e.form,"zippwd",t)},expression:"form.zippwd"}})],1),"mssql"===e.taskinfo.dbtype&&""!==e.taskinfo.cmds&&1===e.taskinfo.types?s("el-form-item",{attrs:{label:"保存路径",prop:"savepath"}},[[s("div",{staticStyle:{float:"left"}},[s("el-input",{attrs:{placeholder:"数据库所在地的保存路径，要确保一定存在"},model:{value:e.form.savepath,callback:function(t){e.$set(e.form,"savepath",t)},expression:"form.savepath"}})],1),s("div",{staticStyle:{float:"left","margin-left":"5px"}},[s("el-popover",{attrs:{placement:"top-start",title:"注意事项",trigger:"hover",content:"数据库所在地的保存路径，要确保一定存在,在此模式下，无法支持远程设备的压缩及异地存储"}},[s("el-link",{attrs:{slot:"reference",underline:!1,type:"warning",icon:"el-icon-info"},slot:"reference"})],1)],1)]],2):e._e(),"mssql"!==e.taskinfo.dbtype||""===e.taskinfo.cmds||1!==e.taskinfo.types?s("el-form-item",{attrs:{label:"异地存储"}},[s("el-select",{attrs:{multiple:""},model:{value:e.form.rs,callback:function(t){e.$set(e.form,"rs",t)},expression:"form.rs"}},e._l(e.remotestorages,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),s("el-form-item",{attrs:{label:""}},[s("el-button",{attrs:{size:"mini"},on:{click:e.stepCut}},[e._v("上一步")]),s("el-button",{on:{click:e.submit}},[e._v("下一步")])],1)],1)],1)},b=[],h={props:{flush:{type:Function,default:function(){}},taskinfo:{type:Object,default:function(){}},stepCut:{type:Function,default:function(){}}},computed:{rules:function(e){e.form;var t={savepath:[{required:!0,message:"请输入保存路径",trigger:"blur"}],zippwd:[{required:!0,message:"输入压缩密码",trigger:"blur"}]};return t}},data:function(){return{form:{enablezippwd:0,rs:[],savepath:"",zippwd:""},remotestorages:[],props:{label:"label",children:"children",isLeaf:"isLeaf",path:"path"}}},methods:{defget:function(){this.ftpGet()},ftpGet:function(){var e=this;this.$http.Get(this.$api.ftps,{page:1,count:-1},(function(t){e.remotestorages=t.data}))},submit:function(){var e=this;this.$refs["form"].validate((function(t){if(!t)return console.log("error submit!!"),!1;e.flush(e.form)}))},nodeClick:function(e){this.$refs.savepath.setCheckedNodes([e]),this.form.savepath=e.path},loadNode:function(e,t){0===e.level?this.$http.Get(this.$api.dirlist,{},(function(e){return t(e)})):this.$http.Get(this.$api.dirlist,{dir:e.data.path},(function(e){return t(e)}))}}},g=h,k=Object(u["a"])(g,m,b,!1,null,null,null),v=k.exports,y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-form",{ref:"form",attrs:{model:e.form,size:"mini","label-width":"180px",rules:e.rules}},[s("el-form-item",{attrs:{label:"执行频率"}},[s("el-select",{on:{change:e.changepinlv},model:{value:e.pinlv,callback:function(t){e.pinlv=t},expression:"pinlv"}},e._l(e.$public.pinlvs,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),"month"===e.pinlv?s("el-form-item",{attrs:{label:"日期"}},[s("el-select",{attrs:{placeholder:"请选择"},on:{change:e.cjobs},model:{value:e.day,callback:function(t){e.day=t},expression:"day"}},e._l(e.$public.days,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"week"===e.pinlv?s("el-form-item",{attrs:{label:"周"}},[s("el-select",{attrs:{placeholder:"请选择"},on:{change:e.cjobs},model:{value:e.week,callback:function(t){e.week=t},expression:"week"}},e._l(e.$public.weeks,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),s("el-form-item",{attrs:{label:"时间点"}},[s("el-time-picker",{attrs:{placeholder:"任意时间点","value-format":"H m s"},on:{change:e.createjobs},model:{value:e.times,callback:function(t){e.times=t},expression:"times"}})],1),s("el-form-item",{attrs:{label:"计划任务",prop:"crontab",rules:[{required:!0,message:"请输入 计划任务",trigger:"blur"}]}},[s("el-input",{model:{value:e.form.crontab,callback:function(t){e.$set(e.form,"crontab",t)},expression:"form.crontab"}})],1),"mssql"!==e.taskinfo.dbtype||""===e.taskinfo.cmds||1!==e.taskinfo.types?s("el-form-item",{attrs:{label:"本地备份保留数"}},[s("el-input-number",{attrs:{min:1,max:100},model:{value:e.form.expire,callback:function(t){e.$set(e.form,"expire",t)},expression:"form.expire"}}),e._v(" 个 ")],1):e._e(),s("el-form-item",[s("el-button",{attrs:{size:"mini"},on:{click:e.stepCut}},[e._v("上一步")]),s("el-button",{on:{click:e.submit}},[e._v("下一步")])],1)],1)],1)},_=[],w={props:{flush:{type:Function,default:function(){}},taskinfo:{type:Object,default:function(){}},stepCut:{type:Function,default:function(){}}},data:function(){return{form:{crontab:"",expire:0},day:"1",week:"1",times:"",pinlv:"day"}},computed:{rules:function(){var e={crontab:[{required:!0,message:"请输入 计划任务",trigger:"blur"}]};return e}},methods:{submit:function(){var e=this;this.$refs["form"].validate((function(t){if(!t)return console.log("error submit!!"),!1;e.flush(e.form)}))},changepinlv:function(e){this.pinlv=e,this.cjobs()},createjobs:function(e){this.times=e,this.cjobs()},cjobs:function(){var e=this.times.split(" "),t="";3===e.length&&(t=e[2]+" "+e[1]+" "+e[0],"month"===this.pinlv&&this.day?t=t+" "+this.day+" * *":"week"===this.pinlv&&this.week?t=t+" * * "+this.week:t+=" * * *"),this.form.crontab=t}}},$=w,q=Object(u["a"])($,y,_,!1,null,null,null),x=q.exports,z={components:{baseView:f,saveView:v,jobView:x},props:{flush:{type:Function,default:function(){}}},data:function(){return{NewTaskDialog:!1,step:0,taskinfo:{},remotestorages:[]}},methods:{addForm:function(){var e=this;this.NewTaskDialog=!0,this.$nextTick((function(){e.$refs.baseView.defget(),e.$refs.saveView.defget()}))},stepCut:function(){var e=this;this.step=this.step-1,this.$nextTick((function(){e.$refs.baseView.defget(),e.$refs.saveView.defget()}))},stepPlus:function(e){for(var t in e)this.taskinfo[t]=e[t];this.step=this.step+1},addtask:function(){var e=this;this.$http.Post(this.$api.task,this.taskinfo,(function(){e.NewTaskDialog=!1,e.flush()}),"添加任务")}}},V=z,S=Object(u["a"])(V,r,l,!1,null,null,null),N=S.exports,T=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.dialogDirVisible?s("el-dialog",{attrs:{title:"请选择",visible:e.dialogDirVisible},on:{"update:visible":function(t){e.dialogDirVisible=t}}},[s("dirlist",{attrs:{dialogDirVisible:e.dialogDirVisible,"key-name":e.keyName},on:{close:e.changeDir}})],1):e._e(),s("el-drawer",{attrs:{title:"编辑任务",visible:e.drawer,direction:"rtl",size:550,modal:!1},on:{"update:visible":function(t){e.drawer=t}}},[s("el-row",[s("el-col",{attrs:{span:22,offset:1}},[s("el-form",{ref:"taskinfo",attrs:{model:e.taskinfo,size:"mini","label-width":"110px",rules:e.rules}},[s("el-divider",[e._v("数据库配置")]),s("el-form-item",{attrs:{label:"备份对象类型",prop:"types"}},[[s("div",{staticStyle:{float:"left"}},[s("el-select",{attrs:{placeholder:"选择备份对象类型"},on:{change:e.changetypes},model:{value:e.taskinfo.types,callback:function(t){e.$set(e.taskinfo,"types",t)},expression:"taskinfo.types"}},e._l(e.$public.tasktypes,(function(e,t){return s("el-option",{key:t+"types",attrs:{value:e.value,label:e.label}})})),1)],1),s("div",{staticStyle:{float:"left","margin-left":"5px"}},[s("el-popover",{attrs:{placement:"top-start",title:"注意事项",trigger:"hover",content:"备份对象涉及到sqlcmd命令是否支持远程存储，只有本机sqlcmd导出的文件可以进行远程存储"}},[s("el-link",{attrs:{slot:"reference",underline:!1,type:"warning",icon:"el-icon-info"},slot:"reference"})],1)],1)]],2),s("el-form-item",{attrs:{label:"数据库类型",prop:"dbtype"}},[s("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){e.taskinfo.cmds=""}},model:{value:e.taskinfo.dbtype,callback:function(t){e.$set(e.taskinfo,"dbtype",t)},expression:"taskinfo.dbtype"}},e._l(e.$public.sqltypes,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),"mongodb"===e.taskinfo.dbtype?s("el-form-item",{attrs:{label:"备份命令",prop:"cmds"}},[[s("div",{staticStyle:{float:"left"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:e.taskinfo.cmds,callback:function(t){e.$set(e.taskinfo,"cmds",t)},expression:"taskinfo.cmds"}},e._l(e.cmds,(function(t,i){return s("el-option",{key:i+"cmds",attrs:{label:t.name,value:t.id,disabled:0!==t.status||t.dbtype!=e.taskinfo.dbtype}})})),1)],1),s("div",{staticStyle:{float:"left","margin-left":"5px"}},[s("el-popover",{attrs:{placement:"top-start",title:"注意事项",trigger:"hover",content:"备份对象涉及到sqlcmd命令是否支持远程存储，只有本机sqlcmd导出的文件可以进行远程存储"}},[s("el-link",{attrs:{slot:"reference",underline:!1,type:"warning",icon:"el-icon-info"},slot:"reference"})],1)],1)]],2):s("el-form-item",{attrs:{label:"备份命令",prop:"cmds"}},[[s("div",{staticStyle:{float:"left"}},[s("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.taskinfo.cmds,callback:function(t){e.$set(e.taskinfo,"cmds",t)},expression:"taskinfo.cmds"}},e._l(e.cmds,(function(t,i){return s("el-option",{key:i+"cmds",attrs:{label:t.name,value:t.id,disabled:0!==t.status||t.dbtype!=e.taskinfo.dbtype}})})),1)],1),s("div",{staticStyle:{float:"left","margin-left":"5px"}},[s("el-popover",{attrs:{placement:"top-start",title:"注意事项",trigger:"hover",content:"不选择备份命令，默认将使用xorm的dump功能,目前此功能支持 mysql / mssql / pgsql / sqlite3"}},[s("el-link",{attrs:{slot:"reference",underline:!1,type:"warning",icon:"el-icon-info"},slot:"reference"})],1)],1)]],2),e.$public.checkValueInArr(e.taskinfo.dbtype,["mysql","mssql","postgres","mongodb"])?s("el-form-item",{attrs:{label:"SQL地址",prop:"host"}},[s("el-input",{model:{value:e.taskinfo.host,callback:function(t){e.$set(e.taskinfo,"host",t)},expression:"taskinfo.host"}})],1):e._e(),e.$public.checkValueInArr(e.taskinfo.dbtype,["mysql","mssql","postgres","mongodb"])?s("el-form-item",{attrs:{label:"SQL端口",prop:"port"}},[s("el-input",{model:{value:e.taskinfo.port,callback:function(t){e.$set(e.taskinfo,"port",t)},expression:"taskinfo.port"}})],1):e._e(),e.$public.checkValueInArr(e.taskinfo.dbtype,["mysql","mssql","postgres","mongodb"])?s("el-form-item",{attrs:{label:"SQL用户名",prop:"user"}},[s("el-input",{model:{value:e.taskinfo.user,callback:function(t){e.$set(e.taskinfo,"user",t)},expression:"taskinfo.user"}})],1):e._e(),e.$public.checkValueInArr(e.taskinfo.dbtype,["mysql","mssql","postgres","mongodb"])?s("el-form-item",{attrs:{label:"SQL密码",prop:"password"}},[s("el-input",{attrs:{"show-password":""},model:{value:e.taskinfo.password,callback:function(t){e.$set(e.taskinfo,"password",t)},expression:"taskinfo.password"}})],1):e._e(),"postgres"===e.taskinfo.dbtype?s("el-form-item",{attrs:{label:"PG默认库",prop:"defdbname"}},[s("el-input",{model:{value:e.taskinfo.defdbname,callback:function(t){e.$set(e.taskinfo,"defdbname",t)},expression:"taskinfo.defdbname"}})],1):e._e(),e.$public.checkValueInArr(e.taskinfo.dbtype,["mysql","mssql","postgres","mongodb"])?s("el-form-item",{attrs:{label:"数据库名",prop:"dbname"}},[s("el-tag",{attrs:{type:"primary",size:"mini"}},[e._v(e._s(e.taskinfo.dbname))]),s("el-button",{attrs:{type:"text"},on:{click:e.getdb}},[e._v("更换")])],1):e._e(),"mysql"===e.taskinfo.dbtype?s("el-form-item",{attrs:{label:"字符编码"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:e.taskinfo.char,callback:function(t){e.$set(e.taskinfo,"char",t)},expression:"taskinfo.char"}},e._l(e.$public.chars,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"sqlite"===e.taskinfo.dbtype?s("el-form-item",{attrs:{label:"数据库路径",prop:"dbpath"}},[s("el-input",{attrs:{disabled:!0},model:{value:e.taskinfo.dbpath,callback:function(t){e.$set(e.taskinfo,"dbpath",t)},expression:"taskinfo.dbpath"}},[s("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){return e.enableDirSearch("dbpath")}},slot:"append"})],1)],1):e._e(),s("el-divider",[e._v("备份存储配置")]),"mssql"===e.taskinfo.dbtype&&""!==e.taskinfo.cmds&&1===e.taskinfo.types?s("el-form-item",{attrs:{label:"保存路径",prop:"savepath"}},[[s("div",{staticStyle:{float:"left"}},[s("el-input",{model:{value:e.taskinfo.savepath,callback:function(t){e.$set(e.taskinfo,"savepath",t)},expression:"taskinfo.savepath"}})],1),s("div",{staticStyle:{float:"left","margin-left":"5px"}},[s("el-popover",{attrs:{placement:"top-start",title:"注意事项",trigger:"hover",content:"数据库所在地的保存路径，要确保一定存在,在此模式下，无法支持远程设备的压缩及异地存储"}},[s("el-link",{attrs:{slot:"reference",underline:!1,type:"warning",icon:"el-icon-info"},slot:"reference"})],1)],1)]],2):e._e(),"mssql"!==e.taskinfo.dbtype||""===e.taskinfo.cmds||1!==e.taskinfo.types?s("el-form-item",{attrs:{label:"本地保存路径",prop:"savepath"}},[s("el-input",{attrs:{disabled:!0},model:{value:e.taskinfo.savepath,callback:function(t){e.$set(e.taskinfo,"savepath",t)},expression:"taskinfo.savepath"}},[s("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){return e.enableDirSearch("savepath")}},slot:"append"})],1)],1):e._e(),"mssql"!==e.taskinfo.dbtype||""===e.taskinfo.cmds||1!==e.taskinfo.types?s("el-form-item",{attrs:{label:"是否加密"}},[s("el-switch",{attrs:{"inactive-value":0,"active-value":1},model:{value:e.taskinfo.enablezippwd,callback:function(t){e.$set(e.taskinfo,"enablezippwd",t)},expression:"taskinfo.enablezippwd"}})],1):e._e(),1!==e.taskinfo.enablezippwd||"mssql"===e.taskinfo.dbtype&&""!==e.taskinfo.cmds?e._e():s("el-form-item",{attrs:{label:"压缩密码"}},[s("el-input",{attrs:{"show-password":""},model:{value:e.taskinfo.zippwd,callback:function(t){e.$set(e.taskinfo,"zippwd",t)},expression:"taskinfo.zippwd"}})],1),"mssql"!==e.taskinfo.dbtype||""===e.taskinfo.cmds?s("el-form-item",{attrs:{label:"异地存储"}},[s("el-select",{attrs:{multiple:""},model:{value:e.taskinfo.rs,callback:function(t){e.$set(e.taskinfo,"rs",t)},expression:"taskinfo.rs"}},e._l(e.remotestorages,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),s("el-divider",[e._v("任务配置")]),s("el-form-item",{attrs:{label:"执行频率"}},[s("el-select",{on:{change:e.changepinlv},model:{value:e.pinlv,callback:function(t){e.pinlv=t},expression:"pinlv"}},e._l(e.$public.pinlvs,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),"month"===e.pinlv?s("el-form-item",{attrs:{label:"日期"}},[s("el-select",{attrs:{placeholder:"请选择"},on:{change:e.cjobs},model:{value:e.day,callback:function(t){e.day=t},expression:"day"}},e._l(e.$public.days,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),"week"===e.pinlv?s("el-form-item",{attrs:{label:"周"}},[s("el-select",{attrs:{placeholder:"请选择"},on:{change:e.cjobs},model:{value:e.week,callback:function(t){e.week=t},expression:"week"}},e._l(e.$public.weeks,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):e._e(),s("el-form-item",{attrs:{label:"时间点"}},[s("el-time-picker",{attrs:{placeholder:"任意时间点","value-format":"H m s"},on:{change:e.createjobs},model:{value:e.times,callback:function(t){e.times=t},expression:"times"}})],1),s("el-form-item",{attrs:{label:"计划任务",prop:"crontab"}},[s("el-input",{model:{value:e.taskinfo.crontab,callback:function(t){e.$set(e.taskinfo,"crontab",t)},expression:"taskinfo.crontab"}})],1),s("el-form-item",{attrs:{label:"本地备份保留数"}},[s("el-input-number",{attrs:{min:1,max:100},model:{value:e.taskinfo.expire,callback:function(t){e.$set(e.taskinfo,"expire",t)},expression:"taskinfo.expire"}}),e._v(" 个 ")],1),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:e.edittask}},[e._v("确定")])],1)],1)],1)],1)],1),s("el-dialog",{attrs:{title:"选择数据库",visible:e.dialogTableVisible,modal:!1},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[s("el-select",{attrs:{placeholder:"请选择",size:"mini"},model:{value:e.dbname,callback:function(t){e.dbname=t},expression:"dbname"}},e._l(e.dbnames,(function(e){return s("el-option",{key:e,attrs:{label:e,value:e}})})),1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"mini"},on:{click:function(t){e.dialogTableVisible=!1}}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.changedbname}},[e._v("确 定")])],1)],1)],1)},G=[],j=(s("b0c0"),s("9794")),C={components:{Dirlist:j["a"]},props:{flush:{type:Function,default:function(){}}},computed:{rules:function(){var e={types:[{required:!0,message:"请选择类型名称",trigger:"change"}],dbtype:[{required:!0,message:"请选择类型名称",trigger:"blur"}],crontab:[{required:!0,message:"请输入 计划任务",trigger:"blur"}]};return"mysql"===this.taskinfo.dbtype||"mssql"===this.taskinfo.dbtype?(e["host"]=[{required:!0,message:"请选择类型名称",trigger:["blur","change"]}],e["port"]=[{required:!0,message:"请输入主机端口",trigger:"blur"},{type:"number",message:"必须为数字",trigger:"blur",transform:function(e){return Number(e)}}],e["password"]=[{required:!0,message:"请输入密码",trigger:"blur"}],e["user"]=[{required:!0,message:"请输入用户名",trigger:"blur"}],e["dbnames"]=[{required:!0,message:"请输入数据库名",trigger:"blur"}],e["savepath"]=[{required:!0,message:"请输入保存路径",trigger:"blur"}]):"postgres"===this.taskinfo.dbtype||"mongodb"===this.taskinfo.dbtype?(e["host"]=[{required:!0,message:"请选择类型名称",trigger:["blur","change"]}],e["port"]=[{required:!0,message:"请输入主机端口",trigger:"blur"},{type:"number",message:"必须为数字",trigger:"blur",transform:function(e){return Number(e)}}],e["password"]=[{required:!0,message:"请输入密码",trigger:"blur"}],e["user"]=[{required:!0,message:"请输入用户名",trigger:"blur"}],e["dbnames"]=[{required:!0,message:"请输入数据库名",trigger:"blur"}],e["defdbname"]=[{required:!0,message:"请输入保存路径",trigger:"blur"}]):"sqlite"===this.taskinfo.dbtype&&(e[" dbpath"]=[{required:!0,message:"请选择数据库路径",trigger:"blur"}]),e}},data:function(){return{dbname:"",dialogTableVisible:!1,drawer:!1,dialogDirVisible:!1,keyName:"",taskinfo:{dbtype:"mysql",char:"utf8",port:"",crontab:"",rs:[],expire:1},day:"1",week:"1",times:"",pinlv:"day",remotestorages:[],rowid:"",cmds:[],dbnames:[]}},methods:{getcmds:function(){var e=this;this.$http.Get(this.$api.getcmds,{},(function(t){e.cmds=t}))},changedbname:function(){this.taskinfo["dbname"]=this.dbname,this.dialogTableVisible=!1},getdb:function(){var e=this;this.$http.Get(this.$api.getdbinfo,{User:this.taskinfo.user,Password:this.taskinfo.password,Host:this.taskinfo.host,Port:this.taskinfo.port,Char:this.taskinfo.char,Dbtype:this.taskinfo.dbtype,Defdbname:this.taskinfo.defdbname},(function(t){e.dbnames=t,e.dialogTableVisible=!0}))},open:function(e){this.ftpGet(),this.getcmds(),e?(this.rowid=e,this.GetOneTask(this.rowid)):(this.$message.error("获取不到id"),this.$router.push({path:"/backup/sqltasklist"})),this.drawer=!0},changeDir:function(e){this.taskinfo[e.name]=e.value,this.dialogDirVisible=!1},enableDirSearch:function(e){this.keyName=e,this.dialogDirVisible=!0},ftpGet:function(){var e=this;this.$http.Get(this.$api.ftps,{page:1,count:-1},(function(t){e.remotestorages=t.data}))},changepinlv:function(e){this.pinlv=e,this.cjobs()},createjobs:function(e){this.times=e,this.cjobs()},edittask:function(){var e=this;this.$http.Put(this.$api.task+"/"+this.rowid,this.taskinfo,(function(){e.flush(),e.drawer=!1}),"修改任务")},cjobs:function(){var e=this.times.split(" "),t="";3===e.length&&(t=e[2]+" "+e[1]+" "+e[0],"month"===this.pinlv&&this.day?t=t+" "+this.day+" * *":"week"===this.pinlv&&this.week?t=t+" * * "+this.week:t+=" * * *"),this.taskinfo.crontab=t},GetOneTask:function(e){var t=this;this.$http.Get(this.$api.task+"/"+e,{},(function(e){t.taskinfo=e}))},changetypes:function(e){this.taskinfo.host="",0===e&&this.getlocalip()},getlocalip:function(){var e=this;this.$http.Get(this.$api.getlocal,{},(function(t){e.hosts=t}))}}},I=C,A=Object(u["a"])(I,T,G,!1,null,null,null),D=A.exports,E=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-button",{attrs:{type:"warning",size:"mini"},on:{click:e.open}},[e._v("备份命令设置")]),s("el-dialog",{attrs:{title:"备份命令设置",visible:e.dialog,modal:!1},on:{"update:visible":function(t){e.dialog=t}}},[s("el-table",{attrs:{data:e.list,size:"mini",border:""}},[s("el-table-column",{attrs:{label:"命令",prop:"name",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:0===t.row.status?"success":"danger",size:"mini"}},[e._v(e._s(t.row.name))])]}}])}),s("el-table-column",{attrs:{label:"路径",prop:"path"}}),s("el-table-column",{attrs:{label:"适用数据库",prop:"dbtype"}}),s("el-table-column",{attrs:{label:"就绪",prop:"path",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:0===t.row.status?"success":"danger",size:"mini"}},[e._v(e._s(0===t.row.status?"是":"否"))])]}}])}),s("el-table-column",{attrs:{label:"数据导出存储地",prop:"commit"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:0===t.row.commit?"success":"warning",size:"mini"}},[e._v(e._s(0===t.row.commit?"当前":"数据库所在地"))])]}}])}),s("el-table-column",{attrs:{label:"是否支持异地存储",prop:"commit"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-tag",{attrs:{type:0===t.row.commit?"success":"warning",size:"mini"}},[e._v(e._s(0===t.row.commit?"是":"否"))])]}}])}),s("el-table-column",{attrs:{label:"操作",prop:"path",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-link",{attrs:{underline:!1,type:"warning",size:"mini"},on:{click:function(s){return e.edit(t.row.id)}}},[e._v("编辑")])]}}])})],1)],1),s("editview",{ref:"editview",attrs:{flush:e.getcmds}})],1)},L=[],P=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-dialog",{attrs:{title:"编辑备份命令",visible:e.dialog,modal:!1},on:{"update:visible":function(t){e.dialog=t}}},[s("el-form",{attrs:{model:e.form,size:"mini","label-width":"80px"}},[s("el-form-item",{attrs:{label:"命令"}},[s("el-input",{attrs:{placeholder:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),s("el-form-item",{attrs:{label:"路径"}},[s("el-input",{attrs:{placeholder:""},model:{value:e.form.path,callback:function(t){e.$set(e.form,"path",t)},expression:"form.path"}})],1),s("el-form-item",{attrs:{label:""}},[s("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("提交")])],1)],1)],1)],1)},F=[],O={props:{flush:{type:Function,default:function(){}}},data:function(){return{dialog:!1,form:{}}},methods:{getdata:function(e){var t=this;this.$http.Get(this.$api.getcmd,{id:e},(function(e){t.form=e,t.dialog=!0}))},submit:function(){var e=this;this.$http.Put(this.$api.getcmd,this.form,(function(t){e.flush(),e.dialog=!1}))}}},Q=O,H=Object(u["a"])(Q,P,F,!1,null,null,null),J=H.exports,M={components:{editview:J},data:function(){return{dialog:!1,list:[]}},methods:{edit:function(e){console.log(e),console.log(this.$refs.editview),this.$refs.editview.getdata(e)},getcmds:function(){var e=this;this.$http.Get(this.$api.getcmds,{},(function(t){e.list=t}))},open:function(){this.getcmds(),this.dialog=!0}}},U=M,B=Object(u["a"])(U,E,L,!1,null,null,null),R=B.exports,X={components:{AddTask:N,EditTask:D,cmds:R},data:function(){return{tasks:[],editTaskId:"",total:0,currentPage:1,pageSize:10,dialogFormVisible:!1,formLabelWidth:"120px"}},methods:{deleteTask:function(e){var t=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$http.Delete(t.$api.task+"/"+e,{},(function(){t.taskGet()}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},addclose:function(){this.dialogFormVisible=!1,this.taskGet()},taskGet:function(){var e=this;this.$http.Get(this.$api.tasks,{types:"sql",page:this.currentPage,count:this.pageSize},(function(t){e.tasks=t.data,e.total=t.count}))},current_change:function(e){this.currentPage=e,this.taskGet()},runJob:function(e){this.$http.Put(this.$api.runjob+"/"+e,{},(function(){}),"立即执行任务")},edit:function(e){this.$refs.EditTask.open(e)}},created:function(){this.taskGet()}},Y=X,W=Object(u["a"])(Y,i,a,!1,null,"20763d80",null);t["default"]=W.exports}}]);